{% extends "page.html" %}
{% block body %}

<body class="grey lighten-3 animated fadeIn">

  <!--Main Navigation-->
  <header>

    <!-- Navbar -->
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark blue scrolling-navbar">
      <div class="container-fluid">

        <!-- Brand -->
        <a class="navbar-brand waves-effect" href="https://mdbootstrap.com/docs/jquery/" target="_blank">
          <strong class="blue-text">MDB</strong>
        </a>

        <!-- Collapse -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Links -->
        <div class="collapse navbar-collapse" id="navbarSupportedContent">

          
          <ul class="navbar-nav mr-auto"><!-- Left 
            <li class="nav-item active">
              <a class="nav-link waves-effect" href="#">Home
                <span class="sr-only">(current)</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link waves-effect" href="https://mdbootstrap.com/docs/jquery/" target="_blank">About
                MDB</a>
            </li>
            <li class="nav-item">
              <a class="nav-link waves-effect" href="https://mdbootstrap.com/docs/jquery/getting-started/download/"
                target="_blank">Free
                download</a>
            </li>
            <li class="nav-item">
              <a class="nav-link waves-effect" href="https://mdbootstrap.com/education/bootstrap/" target="_blank">Free
                tutorials</a>
            </li>-->
          </ul>

          <!-- Right -->
          <ul class="navbar-nav nav-flex-icons float-right">
            <li class="nav-item">
              <a href="https://www.facebook.com/mdbootstrap" class="nav-link waves-effect" target="_blank">
                <i class="fas fa-user mr-1"></i> mailmail@email.com
              </a>
            </li>
            
          </ul>

        </div>

      </div>
    </nav>
    <!-- Navbar -->

    <!-- Sidebar -->
    <div class="sidebar-fixed position-fixed stylish-color">

      <a class="logo-wrapper waves-effect">
        <img src="https://mdbootstrap.com/img/logo/mdb-email.png" class="img-fluid" alt="">
      </a>

      <div class="list-group list-group-flush">
        <a href="/" class="list-group-item active waves-effect">
          <i class="fas fa-home mr-3"></i>Inicio
        </a>
        <a href="/cameras" class="list-group-item list-group-item-action stylish-color text-white waves-effect">
          <i class="fas fa-camera mr-3"></i>Cámaras</a>
        <a href="#" class="list-group-item list-group-item-action stylish-color text-white waves-effect">
          <i class="fas fa-bell mr-3"></i>Notificaciones</a>
        <a href="/people" class="list-group-item list-group-item-action stylish-color text-white  waves-effect">
          <i class="fas fa-users mr-3"></i>Personas</a>
        <a href="#" class="list-group-item list-group-item-action stylish-color text-white  waves-effect">
          <i class="fas fa-user-circle mr-3"></i>Detecciones</a>
        <a href="#" class="list-group-item list-group-item-action stylish-color text-white  waves-effect">
          <i class="fas fa-cog mr-3"></i>Configuración</a>
      </div>

    </div>
    <!-- Sidebar -->

  </header>
  <!--Main Navigation-->

  <!--Main layout-->
  <main class="pt-5">
    <div class="container-fluid mt-5">

      <!-- Heading -->
      <div class="card mb-4 wow fadeIn border-left-blue">

        <!--Card content-->
        <div class="card-body d-sm-flex justify-content-between">

          <h5 class="mb-2 mb-sm-0 pt-1">
            <span class="blue-text">CÁMARAS</span>
          </h5>

          <div class="d-flex justify-content-center">
            <a href="" class="boton-redondeado"><i class="fas fa-plus"></i> Agregar cámara</a>
          </div>

        </div>

      </div>
      <!-- Heading -->

    <!--Grid row-->
    <div class="row wow mb-4  fadeIn">
      
    </div>

    <div class="card mb-4 wow fadeIn border-left-blue">

      <!--Card content-->
      <div class="card-body d-sm-flex justify-content-between">

        <h5 class="mb-2 mb-sm-0 pt-1">
          <span class="blue-text">ÚLTIMAS DETECCIONES</span>
        </h5>

        <div class="d-flex justify-content-center">
          
          <a href="#" class="boton-redondeado mr-3"><i class="fas fa-search-plus"></i> Ver todas</a>
          <a href="#face-detections" class="boton-redondeado" onclick="get_faces()"><i class="fas fa-sync"></i> Actualizar</a>
        </div>

      </div>

    </div>
    <!-- Heading -->
    <!--Grid row-->
    <div id="face-detections" class="row wow mb-4  fadeIn">
    </div>

  </main>
  <!--Main layout-->

  <!--Footer-->
  <footer class="page-footer text-center font-small primary-color-dark darken-2 mt-4 wow fadeIn">

    <!--Call to action-->
    <div class="pt-4">
      <a class="btn btn-outline-white" href="https://mdbootstrap.com/docs/jquery/getting-started/download/" target="_blank"
        role="button">Download
        MDB
        <i class="fas fa-download ml-2"></i>
      </a>
      <a class="btn btn-outline-white" href="https://mdbootstrap.com/education/bootstrap/" target="_blank" role="button">Start
        free tutorial
        <i class="fas fa-graduation-cap ml-2"></i>
      </a>
    </div>
    <!--/.Call to action-->

    <hr class="my-4">

    

    <!--Copyright-->
    <div class="footer-copyright py-3">
      © 2019 Copyright:
      <a href="https://mdbootstrap.com/education/bootstrap/" target="_blank"> MDBootstrap.com </a>
    </div>
    <!--/.Copyright-->

  </footer>
  <!--/.Footer-->

  {% endblock %}
  {% block scripts %} 
  <script type="text/javascript" src="static/js/dashboard.js"></script>

  <!-- Initializations -->
  <script type="text/javascript">
    // Animations initialization
    new WOW().init();

  </script>

  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>
  <script>
    //Important count for detections id. 
    var count = 0

    function get_faces(){
      console.log('asdasdas');
        $.ajax({
            type: "GET",
            url: "{{ url_for('get_faces_name', name='Gonza2_222_4b') }}",
            success: function(data) {
              detections = JSON.parse(data)
              console.log('dale pa')
              add_faces(detections)
            },
            error: function(error) {
              console.log(error);
            }
      });
    }
      
    function add_faces(detections){
      $("#face-detections").children().remove();
      for (var i = 0; i < detections.length ; i++){
        count++
      console.log(count)

        html = '<div  id="item-prediction-'+detections[i]["name"]+count+'" class="col-md-2 mb-4">'
               + '<div class="card z-depth-0">'
                + '<a class="black text-center" href="'+detections[i]["filename"]+'/'+parseInt(detections[i]["time_video"])+'"><img class="card-img-top" src="static/faces/'+detections[i]["thumb"]+'" alt="Card image cap"></a>'
        color = 'green'
        if (detections[i]["name"].includes('unknown'))
          if (detections[i]["name"].includes('-'))
            color = 'yellow'
          else 
            color = 'red'
        
        html +=     '<div class="card-body border-left-'+color+' py-3">'
                      +'<h6 class="m-0 mb-1 detection-name">'+ detections[i]["name"] + '</h6>'
                      +'<h6 class="m-0 mb-1 detection-camera">Cámara ' + detections[i]["camera"] + '</h6>'
                      +'<h6 class="m-0 detection-date">' + detections[i]["time"] + '</h6>'
                      +'<div class="mt-2 progress md-progress" style="height: 20px"><div class="progress-bar '+color+'" role="progressbar" style="width: ' + detections[i]["confidence"] + '%; height: 20px" aria-valuenow="' + detections[i]["confidence"] + '" aria-valuemin="0" aria-valuemax="100">' + detections[i]["confidence"] + '%</div></div>'
                      +'<div id="prediction-actions" class="mt-2 text-center">'
                        +"<a><i class='fas fa-check green-text' ></i></a> <a data-camera='"+detections[i]["camera"]+"' data-thumb='"+detections[i]["thumb"]+"' data-date='"+detections[i]["time"]+"' data-name='"+detections[i]["name"]+"' data-id='"+count+"' class='red-text'><i class='fas fa-times ml-3'></i></a>"
                      +'</div>'
                    +'</div>'
                  +'</div>'

        $("#face-detections").append(html);
      }
    }

    
    $(document).ready(function(){
      get_faces();
    })

      $(document).on('click', '#prediction-actions a', function(){

        name = $(this).attr('data-name');
        camera = $(this).attr('data-camera');
        thumb = $(this).attr('data-thumb');
        date = $(this).attr('data-date');
        id = $(this).attr('data-id');

        $.ajax({
            type: "POST",
            url: "{{ url_for('remove_face') }}",
            data: {"name" : name, "camera": camera, "thumb": thumb, "date": date}, 
            success: function(data) {
              if (data === '200'){
                item = "#item-prediction-" + name + id
                $(item).addClass('fadeOut');
                $(item)
                          .animate({padding: 0})
                          .wrapInner('<div />')
                          .children()
                          .fadeOut(function () {
                            $(item).remove();
                          })
              }
            },
            error: function(error) {
              console.log(error);
            }
      });
      })

      </script>
{% endblock %}
</body>

</html>
